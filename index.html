<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NZ South Island Â· Trip Journal</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#070A13;
  --card:rgba(2,6,23,.78);
  --text:#F8FAFC;
  --sub:#A1A1AA;
  --line:rgba(148,163,184,.28);
  --accent:#38BDF8;
  --warn:#F59E0B;
  --shadow:0 26px 70px rgba(0,0,0,.55);
  --r:22px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Montserrat,system-ui;
  background:#000;
  color:var(--text);
}
.wrap{max-width:1180px;margin:auto;padding:20px}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--r);
  box-shadow:var(--shadow);
  margin-bottom:18px;
}
.pad{padding:18px}

.day{
  border:1px solid var(--line);
  border-radius:18px;
  padding:16px;
  background:rgba(15,23,42,.45);
  margin-bottom:16px;
}
.day h3{margin:0;font-size:1.05rem}
.meta{color:var(--sub);font-size:.8rem;margin:4px 0 12px}

/* -------- Stops -------- */
.stop{
  display:flex;
  gap:10px;
  padding:10px 12px;
  border-radius:14px;
  background:rgba(2,6,23,.45);
  border:1px solid rgba(148,163,184,.18);
  margin-bottom:8px;
}
.icon{width:26px;text-align:center}
.name{flex:1}
.note{color:var(--sub);font-size:.75rem;margin-top:4px}

.nav{
  margin-top:6px;
}
a.btn{
  display:inline-block;
  text-decoration:none;
  padding:5px 10px;
  border-radius:12px;
  font-size:.75rem;
  border:1px solid var(--line);
  color:var(--text);
  background:rgba(15,23,42,.65);
}
a.btn.drive{border-color:var(--warn)}
a.btn.walk{border-color:var(--accent)}

/* -------- Details -------- */
.details-toggle{
  margin-top:12px;
  cursor:pointer;
  font-size:.8rem;
  color:var(--accent);
}
.details{
  display:none;
  margin-top:12px;
  padding:12px 10px;
  border-radius:14px;
  background:rgba(2,6,23,.6);
  border-left:3px solid rgba(148,163,184,.4);
}

.timeline-item{
  display:grid;
  grid-template-columns:90px 1fr;
  gap:10px;
  padding:6px 0;
}
.t-time{color:#94A3B8;font-weight:600}
.t-content{padding-left:6px}

.tag-hotel{color:#60A5FA}
.tag-food{color:#F59E0B}
.tag-drive{color:#FBBF24}
.tag-shop{color:#34D399}
.tag-hike{color:#C084FC}
.tag-time{color:#EF4444;font-weight:700}

.footer{
  text-align:center;
  color:var(--sub);
  font-size:.75rem;
  margin-top:24px;
}
</style>
</head>

<body>
<div class="wrap">

<div class="card pad">
  <h2>ä»æ²ˆé˜³å†¬å¤œåˆ°ç“¦çº³å¡æ—¥è½</h2>
  <div class="meta">ä¸€åœºå±äºæˆ‘ä»¬çš„å…¬è·¯ç”µå½± Â· å¯¼èˆª + æ‰‹å¸æ—¶é—´çº¿</div>
</div>

<div id="timeline"></div>

<div class="footer">NZ South Island Â· Excel â†’ JSON</div>
</div>

<script>
function cleanName(s){
  return s.replace(/ï¼ˆ.*?ï¼‰|\(.*?\)/g,"").trim();
}
function isDrive(a,b){
  const key=/Airport|Lookout|Viewpoint|Track|Lake|Mt |Mount|Glacier|Springs|Bungy|Jet/i;
  return key.test(a)||key.test(b);
}
function dirLink(a,b){
  const mode=isDrive(a,b)?"driving":"walking";
  return {
    mode,
    url:`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(cleanName(a))}&destination=${encodeURIComponent(cleanName(b))}&travelmode=${mode}`
  };
}
function emojiClass(line){
  if(/ğŸ¨|ğŸ›/.test(line)) return "tag-hotel";
  if(/ğŸ½|ğŸœ|â˜•|ğŸ·/.test(line)) return "tag-food";
  if(/ğŸš—|â†’/.test(line)) return "tag-drive";
  if(/ğŸ›’|ğŸ§º/.test(line)) return "tag-shop";
  if(/ğŸ¥¾|ğŸŒ„|ğŸ”/.test(line)) return "tag-hike";
  if(/â°/.test(line)) return "tag-time";
  return "";
}
function parseTimeline(text){
  return text.split("\n").map(l=>{
    const m=l.match(/^([0-9:ï¼‹+â€“\-]+)\s*[ï½œ| ]?(.*)$/);
    if(m) return {time:m[1],content:m[2]};
    return {time:"",content:l};
  });
}

fetch("data.json")
.then(r=>r.json())
.then(data=>{
  const root=document.getElementById("timeline");

  data.forEach(day=>{
    const box=document.createElement("div");
    box.className="day";
    box.innerHTML=`<h3>${day.date}</h3><div class="meta">Stops Â· ${day.stops.length}</div>`;

    /* ----- Sheet1: Stops + Navigation ----- */
    day.stops.forEach((s,i)=>{
      const stop=document.createElement("div");
      stop.className="stop";
      stop.innerHTML=`
        <div class="icon">ğŸ“</div>
        <div class="name">
          ${s.place}
          ${s.note?`<div class="note">${s.note}</div>`:""}
        </div>
      `;
      if(i<day.stops.length-1){
        const n=dirLink(s.place, day.stops[i+1].place);
        const nav=document.createElement("div");
        nav.className="nav";
        nav.innerHTML=`
          <a class="btn ${n.mode==='driving'?'drive':'walk'}" target="_blank" href="${n.url}">
            ${n.mode==='driving'?'ğŸš— Drive':'ğŸš¶ Walk'}
          </a>
        `;
        stop.appendChild(nav);
      }
      box.appendChild(stop);
    });

    /* ----- Sheet2: Timeline ----- */
    if(day.note){
      const toggle=document.createElement("div");
      toggle.className="details-toggle";
      toggle.textContent="â–¼ æŸ¥çœ‹å½“æ—¥è¯¦ç»†è®¡åˆ’";

      const details=document.createElement("div");
      details.className="details";

      parseTimeline(day.note).forEach(it=>{
        const row=document.createElement("div");
        row.className="timeline-item";
        row.innerHTML=`
          <div class="t-time">${it.time}</div>
          <div class="t-content ${emojiClass(it.content)}">${it.content}</div>
        `;
        details.appendChild(row);
      });

      toggle.onclick=()=>{
        const open=details.style.display==="block";
        details.style.display=open?"none":"block";
        toggle.textContent=open?"â–¼ æŸ¥çœ‹å½“æ—¥è¯¦ç»†è®¡åˆ’":"â–² æ”¶èµ·è¯¦ç»†è®¡åˆ’";
      };

      box.appendChild(toggle);
      box.appendChild(details);
    }

    root.appendChild(box);
  });
});
</script>
</body>
</html>
